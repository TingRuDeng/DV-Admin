{% extends 'base.html' %}
{% block self_head_css_js %}
    <link href="/static/css/plugins/datepicker/datepicker3.css" rel="stylesheet">
    <link href="/static/css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="/static/js/simditor/styles/simditor.css" rel="stylesheet">
    <link href="/static/js/simditor/styles/simditor-html.css" rel="stylesheet">
    <script src="/static/js/simditor/scripts/module.js"></script>
    <script src="/static/js/simditor/scripts/hotkeys.js"></script>
    <script src="/static/js/simditor/scripts/uploader.js"></script>
    <script src="/static/js/simditor/scripts/simditor.js"></script>
    <script src="/static/js/simditor/scripts/simditor-font-scale.js"></script>
    <script src="/static/js/simditor/scripts/beautify-html.js"></script>
    <script src="/static/js/simditor/scripts/simditor-html.js"></script>

{% endblock %}
{% load mytags %}
{% load bootstrap %}
{% block content %}
    {% include 'nav_cat_bar.html' %}
    <style type="text/css" media="screen">

        #editor {
            position: relative;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 900px;
            padding-left: 0px;
        }
    </style>
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-10">
                <div class="ibox float-e-margins">
                    <div id="ibox-content" class="ibox-title">
                        <h5> 邮件模板详情-{{ email_obj.name }} </h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>

                    </div>

                    <div class="ibox-content">
                        <div class="col-sm-1" style="padding: 0px 0px 9px 0px;float: right">
                            <span class="btn btn-sm btn-danger reset-change"> 重置修改 </span>
                        </div>
                        <div class="col-sm-1" style="padding: 0px 0px 9px 0px;float: right">
                                <a value="{% url 'sys_email_save' %}" class="btn btn-sm btn-success save-change"> 保存修改 </a>
                        </div>

                        <div class="panel blank-panel">
                            <div id="tab-1" class="ibox float-e-margins tab-pane active">

                                {% if error %}
                                    <div class="alert alert-warning text-center">{{ error }}</div>
                                {% endif %}
                                {% if msg %}
                                    <div class="alert alert-success text-center">{{ msg }}</div>
                                {% endif %}
                                <script id="container" name="content" type="text/plain">
                                    {{ content|safe }}
                                </script>
                                <textarea id="editor" placeholder="Balabala" autofocus></textarea>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block self_footer_js %}
    <script>
        var html = $("#container").html();
        $("#container").html("");
        var editor = new Simditor({
            textarea: $('#editor'),
            allowedTags: ['br', 'html', 'body', 'head', 'title', 'span', 'a', 'img', 'b', 'strong', 'i', 'strike', 'u', 'font', 'p', 'ul', 'ol', 'li', 'blockquote', 'pre', 'code', 'h1', 'h2', 'h3', 'h4', 'hr'],
            toolbar: ['html', 'fontScale', 'title', 'bold', 'italic', 'underline', 'strikethrough', 'color', 'ol', 'ul', 'blockquote', 'code', 'table', 'link', 'image', 'hr', 'indent', 'outdent', 'alignment']
        });
        editor.setValue(html);
        $('.save-change').click(function () {
                var row = $(this).closest('tr');
                if (confirm("确定保存修改?")) {
                    $.get(
                        $(this).attr('value'),
                        {
                            "content": editor.getValue(),
                            "id": {{ email_obj.id }}
                        },
                        function (data) {
                            alert(data);
                            location.href = "{% url 'sys_email_list' %}";
                        }
                    )
                }
            });
        $('.reset-change').click(function () {
                var row = $(this).closest('tr');
                if (confirm("确定重置修改?")) {
                    editor.setValue(html);
                }
            });
    </script>
{% endblock %}